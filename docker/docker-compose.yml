services:
    cuda_tf_opencv:
        build:
            context: .
            dockerfile: Dockerfile
        image: cuda_tensorflow_opencv:latest
        container_name: cuda_tf_opencv
        environment:
            - NVIDIA_VISIBLE_DEVICES=all # Make all GPUs visible
            - NVIDIA_DRIVER_CAPABILITIES=all # Enable all NVIDIA driver capabilities
        volumes:
            - ../:/app
        ports:
            - "8888:8888" # For Jupyter notebook if needed
        restart: unless-stopped
        deploy:
            resources:
                reservations:
                    devices:
                        - driver: nvidia
                          count: all
                          capabilities: [gpu, video, compute, utility]
        # Keep the container running with an interactive command
        tty: true
        stdin_open: true
        command: /bin/bash
